<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üõê Liturgia das Horas</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }
    header {
      background: #3b82f6;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
    }
    main {
      padding: 1rem;
    }
    .entry {
      background: white;
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .entry h2 {
      margin-top: 0;
      font-size: 1.2rem;
    }
    .loading {
      text-align: center;
      padding: 2rem;
      color: #4b5563;
    }
  </style>
</head>
<body>
  <header>üõê Liturgia das Horas</header>
  <main id="content">
    <div class="loading">‚è≥ Carregando Liturgia do dia...</div>
  </main>

  <script>
    const feedUrl = "https://api.codetabs.com/v1/proxy?quest=https%3A%2F%2Fdivineoffice.org%2Ffeed%2F";
    const contentEl = document.getElementById("content");

    const translacoes = {
      "Invitatory": "Invitat√≥rio",
      "Office of Readings": "Of√≠cio de Leituras",
      "Morning Prayer": "Ora√ß√£o da Manh√£",
      "Midmorning Prayer": "Ora√ß√£o da Terceira",
      "Midday Prayer": "Ora√ß√£o da Sexta",
      "Midafternoon Prayer": "Ora√ß√£o da Nona",
      "Evening Prayer": "Ora√ß√£o da Tarde",
      "Night Prayer": "Ora√ß√£o da Noite"
    };

    const ordem = [
      "Invitat√≥rio",
      "Of√≠cio de Leituras",
      "Ora√ß√£o da Manh√£",
      "Ora√ß√£o da Terceira",
      "Ora√ß√£o da Sexta",
      "Ora√ß√£o da Nona",
      "Ora√ß√£o da Tarde",
      "Ora√ß√£o da Noite"
    ];

    function traduzirTitulo(titulo) {
      for (const [en, pt] of Object.entries(translacoes)) {
        if (titulo.includes(en)) {
          return titulo.replace(en, pt);
        }
      }
      return titulo;
    }

    function ordenarPorLiturgia(entries) {
      return entries.sort((a, b) => {
        const ta = ordem.findIndex(o => a.title.includes(o));
        const tb = ordem.findIndex(o => b.title.includes(o));
        return ta - tb;
      });
    }

    function formatarDataHoje() {
      const hoje = new Date();
      return hoje.toLocaleString("en-US", {
        month: "short",
        day: "2-digit"
      }); // ex: "Jul 14"
    }

    async function carregarLiturgia() {
      console.log("üìå üîç Buscando RSS em:", feedUrl);
      try {
        const res = await fetch(feedUrl);
        const data = await res.text();

        const parser = new DOMParser();
        const xml = parser.parseFromString(data, "text/xml");
        const items = xml.querySelectorAll("item");

        const hoje = formatarDataHoje();
        console.log("üìÖ Dia atual:", hoje);

        const entries = Array.from(items).map(item => ({
          title: item.querySelector("title")?.textContent ?? "",
          content: item.querySelector("description")?.textContent ?? ""
        })).filter(entry =>
          entry.title.includes(hoje) &&
          ordem.some(o => traduzirTitulo(entry.title).includes(o))
        ).map(entry => ({
          title: traduzirTitulo(entry.title),
          content: entry.content
        }));

        const ordenados = ordenarPorLiturgia(entries);
        contentEl.innerHTML = "";

        if (ordenados.length === 0) {
          contentEl.innerHTML = `<p class="loading">‚ö†Ô∏è Nenhuma liturgia encontrada para hoje (${hoje}).</p>`;
          return;
        }

        for (const entry of ordenados) {
          const div = document.createElement("div");
          div.className = "entry";
          div.innerHTML = `<h2>${entry.title}</h2><p>${entry.content}</p>`;
          contentEl.appendChild(div);
        }

        console.log("‚úÖ Itens renderizados:", ordenados.length);
      } catch (err) {
        console.error("‚ùå Erro ao carregar:", err);
        contentEl.innerHTML = `<p class="loading">Erro ao carregar o conte√∫do. Verifique sua conex√£o.</p>`;
      }
    }

    carregarLiturgia();
  </script>
</body>
</html>
