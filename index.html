<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liturgia das Horas</title>
    <meta name="description" content="Liturgia das Horas - Of√≠cio Divino em Portugu√™s">
    <meta name="theme-color" content="#2563eb">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkxpdHVyZ2lhIGRhcyBIb3JhcyIsCiAgInNob3J0X25hbWUiOiAiTGl0dXJnaWEiLAogICJkZXNjcmlwdGlvbiI6ICJPZsOtY2lvIERpdmlubyBlbSBQb3J0dWd1w6pzIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMjU2M2ViIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpReElpQm9aV2xuYUhROUlqSTBNU0lnZG1sbGQwSnZlRDBpTUNBd0lESTBNU0F5TkRFaUlHWnBiR3c5SWlNek5qQTVabVFpUGlBOGNHRjBhQ0JrUFNKTklERXpNaTQxSURFeE1TNDFJREVqTWk0MUlERXhNUzQxSURFeU9TNDFJREZHTWpBeklERTFOQ0JETWpBekxqTWdNVFUwSURJd015NDFJREU5TkRJdE1qQXpMalVnTVRRMElDMHlNRE1nTVRRMElDMHhNekl1TlNBeE1URXVOUzB4TXprMExtUWdNRDBpTHo0Z1BIQmhkR2dnWkQwaVRUTTJJREUxTmlCTU0xUTNMamcxTFRBMElEZ2RORGtnTFRBeExUUTNMamcxTFRFMU5pQXpOaUJYZUQ0OEwzTjJaejROIiwKICAgICAgInNpemVzIjogIjI0MXgyNDEiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0sCiAgImNhdGVnb3JpZXMiOiBbInJlbGlnaW9uIiwgInNwaXJpdHVhbGl0eSJdCn0=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQxIiBoZWlnaHQ9IjI0MSIgdmlld0JveD0iMCAwIDI0MSAyNDEiIGZpbGw9IiMzNjA5ZmQiPiA8cGF0aCBkPSJNIDEzMi41IDExMS41IDEzMi41IDExMS41IDEyOS41IDFGMjAzIDE1NCBDMJAM0xNAIDIwMy41IDE0MiAtMjAzLjUgMTQ0IC0yMDMgMTQ0IC0xMzIuNSAxMTEuNS0xMz5kg0Q0PSIvPiA8cGF0aCBkPSJNMzYgMTU2IEwzVDcuODUtMDQgOGdORHkgLTAxLTQ3Ljg1LTE1NiAzNiBXeD48L3N2Zz4N">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --background: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 2rem;
            border: 1px solid #fecaca;
        }
        
        .prayers-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }
        
        .prayer-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .prayer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .prayer-card.expanded {
            grid-column: 1 / -1;
        }
        
        .prayer-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .prayer-time {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .prayer-content {
            line-height: 1.8;
            color: var(--text-primary);
        }
        
        .prayer-content h3 {
            color: var(--primary);
            margin: 1.5rem 0 1rem 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .prayer-content p {
            margin-bottom: 1rem;
        }
        
        .expand-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: auto;
            transition: transform 0.3s ease;
        }
        
        .expand-btn.expanded {
            transform: rotate(180deg);
        }
        
        .offline-indicator {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: #f59e0b;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            font-size: 0.9rem;
            box-shadow: var(--shadow-lg);
            display: none;
        }
        
        .offline-indicator.show {
            display: block;
        }
        
        @media (max-width: 640px) {
            .prayers-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .prayer-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>‚õ™ Liturgia das Horas</h1>
            <p>Of√≠cio Divino em Portugu√™s Brasileiro</p>
        </header>
        
        <main id="main-content">
            <div class="loading">
                <div class="spinner"></div>
                <span style="margin-left: 1rem;">Carregando ora√ß√µes...</span>
            </div>
        </main>
        
        <div class="offline-indicator" id="offline-indicator">
            üì± Modo offline ativo
        </div>
    </div>

    <script>
        // PWA Features without Service Worker (for compatibility)
        // Cache API for offline functionality
        const CACHE_NAME = 'liturgia-horas-v1';
        
        // Simple offline storage using localStorage
        function saveToCache(key, data) {
            try {
                localStorage.setItem(CACHE_NAME + '_' + key, JSON.stringify(data));
            } catch (e) {
                console.log('Cache storage not available');
            }
        }
        
        function getFromCache(key) {
            try {
                const data = localStorage.getItem(CACHE_NAME + '_' + key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                return null;
            }
        }
        
        // Install prompt for PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });
        
        function showInstallButton() {
            const installBtn = document.createElement('button');
            installBtn.textContent = 'üì± Instalar App';
            installBtn.style.cssText = `
                position: fixed;
                bottom: 1rem;
                left: 1rem;
                background: var(--primary);
                color: white;
                border: none;
                padding: 0.75rem 1rem;
                border-radius: 10px;
                font-size: 0.9rem;
                box-shadow: var(--shadow-lg);
                cursor: pointer;
                z-index: 1000;
            `;
            
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        installBtn.remove();
                    }
                    deferredPrompt = null;
                }
            });
            
            document.body.appendChild(installBtn);
        }

        // Estado da aplica√ß√£o
        let prayersData = [];
        let expandedCard = null;

        // Tradu√ß√µes
        const translations = {
            // Horas can√¥nicas
            'Matins': 'Matinas',
            'Lauds': 'Laudes',
            'Prime': 'Prima',
            'Terce': 'Ter√ßa',
            'Sext': 'Sexta',
            'None': 'Nona',
            'Vespers': 'V√©speras',
            'Compline': 'Completas',
            'Morning Prayer': 'Ora√ß√£o da Manh√£',
            'Evening Prayer': 'Ora√ß√£o da Tarde',
            'Night Prayer': 'Ora√ß√£o da Noite',
            'Office of Readings': 'Of√≠cio de Leituras',
            
            // Tempos lit√∫rgicos
            'Advent': 'Advento',
            'Christmas': 'Natal',
            'Lent': 'Quaresma',
            'Easter': 'P√°scoa',
            'Ordinary Time': 'Tempo Comum',
            
            // Elementos da ora√ß√£o
            'Psalm': 'Salmo',
            'Canticle': 'C√¢ntico',
            'Reading': 'Leitura',
            'Prayer': 'Ora√ß√£o',
            'Antiphon': 'Ant√≠fona',
            'Responsory': 'Respons√≥rio',
            'Hymn': 'Hino',
            'Intercessions': 'Preces',
            'Our Father': 'Pai Nosso',
            'Hail Mary': 'Ave Maria',
            'Glory Be': 'Gl√≥ria ao Pai',
            
            // Frases comuns
            'In the name of the Father': 'Em nome do Pai',
            'and of the Son': 'e do Filho',
            'and of the Holy Spirit': 'e do Esp√≠rito Santo',
            'Amen': 'Am√©m',
            'Alleluia': 'Aleluia',
            'Lord, have mercy': 'Senhor, tende piedade',
            'Christ, have mercy': 'Cristo, tende piedade',
            'Holy, holy, holy': 'Santo, santo, santo',
            'Blessed be God': 'Bendito seja Deus',
            'Thanks be to God': 'Gra√ßas a Deus',
            'Glory to God': 'Gl√≥ria a Deus',
            'Peace be with you': 'A paz esteja convosco',
            'And with your spirit': 'E com o vosso esp√≠rito'
        };

        // Fun√ß√£o para traduzir texto
        function translateText(text) {
            if (!text) return text;
            
            let translatedText = text;
            
            // Substituir tradu√ß√µes diretas
            for (const [english, portuguese] of Object.entries(translations)) {
                const regex = new RegExp(english, 'gi');
                translatedText = translatedText.replace(regex, portuguese);
            }
            
            return translatedText;
        }

        // Fun√ß√£o para buscar e processar o feed
        async function fetchPrayers() {
            try {
                // Primeiro, tentar carregar dados do cache
                const cachedData = getFromCache('prayers');
                if (cachedData) {
                    prayersData = cachedData;
                    renderPrayers();
                }
                
                // Como o feed pode ter CORS bloqueado, vamos simular dados de exemplo
                // Em produ√ß√£o, voc√™ precisaria de um proxy ou API pr√≥pria
                const samplePrayers = [
                    {
                        title: 'Matinas',
                        time: '00:00',
                        content: `
                            <h3>Hino</h3>
                            <p>√ì Deus, vinde em meu aux√≠lio.<br>
                            Senhor, socorrei-me e salvai-me.</p>
                            
                            <h3>Salmo 95</h3>
                            <p>Vinde, cantemos de alegria ao Senhor,<br>
                            aclamemos a Rocha que nos salva!<br>
                            Apresentemo-nos diante dele com louvor<br>
                            e celebremo-lo com cantos de alegria!</p>
                            
                            <h3>Leitura</h3>
                            <p>Irm√£os, vigiai e orai, porque n√£o sabeis quando chegar√° o momento. √â como um homem que, partindo para longe, deixou a sua casa, deu autoridade aos seus servos, a cada um o seu trabalho, e ordenou ao porteiro que vigiasse.</p>
                        `
                    },
                    {
                        title: 'Laudes',
                        time: '06:00',
                        content: `
                            <h3>Hino Matinal</h3>
                            <p>√ì esplendor da gl√≥ria do Pai,<br>
                            que da luz fazes brotar a luz,<br>
                            √≥ luz da luz, fonte da claridade,<br>
                            √≥ dia que iluminas o dia!</p>
                            
                            <h3>Salmo 63</h3>
                            <p>√ì Deus, v√≥s sois o meu Deus, por v√≥s eu anseio;<br>
                            tem sede de v√≥s a minha alma,<br>
                            suspira por v√≥s a minha carne,<br>
                            qual terra √°rida, sequiosa, sem √°gua.</p>
                            
                            <h3>C√¢ntico de Zacarias</h3>
                            <p>Bendito seja o Senhor, Deus de Israel,<br>
                            porque visitou e redimiu o seu povo.</p>
                        `
                    },
                    {
                        title: 'Ter√ßa',
                        time: '09:00',
                        content: `
                            <h3>Hino</h3>
                            <p>Vinde, Esp√≠rito Criador,<br>
                            visitai as nossas mentes,<br>
                            enchei da gra√ßa do alto<br>
                            os cora√ß√µes que criastes.</p>
                            
                            <h3>Salmo 119</h3>
                            <p>Na minha ang√∫stia clamei ao Senhor<br>
                            e ele me atendeu.<br>
                            Senhor, livrai-me dos l√°bios mentirosos<br>
                            e da l√≠ngua enganadora.</p>
                        `
                    },
                    {
                        title: 'Sexta',
                        time: '12:00',
                        content: `
                            <h3>Hino</h3>
                            <p>√ì Deus, que a esta hora<br>
                            conduzistes √† cruz o vosso Filho,<br>
                            destru√≠ em n√≥s o pecado<br>
                            e concedei-nos a vossa paz.</p>
                            
                            <h3>Salmo 23</h3>
                            <p>O Senhor √© o meu pastor,<br>
                            nada me falta.<br>
                            Em verdes pastagens me faz repousar<br>
                            e me conduz √†s √°guas tranquilas.</p>
                        `
                    },
                    {
                        title: 'Nona',
                        time: '15:00',
                        content: `
                            <h3>Hino</h3>
                            <p>√ì for√ßa dos que esperam em v√≥s,<br>
                            Senhor, atendei aos que vos invocam,<br>
                            e que a vossa gra√ßa sempre nos proteja<br>
                            e nos livre de todo mal.</p>
                            
                            <h3>Salmo 121</h3>
                            <p>Elevo os meus olhos para os montes:<br>
                            de onde me vir√° o socorro?<br>
                            O meu socorro vem do Senhor<br>
                            que fez o c√©u e a terra.</p>
                        `
                    },
                    {
                        title: 'V√©speras',
                        time: '18:00',
                        content: `
                            <h3>Hino Vespertino</h3>
                            <p>√ì luz serena da santa gl√≥ria<br>
                            do Pai celeste e imortal,<br>
                            √≥ santo e bem-aventurado Jesus Cristo!<br>
                            Chegados ao p√¥r do sol.</p>
                            
                            <h3>Salmo 110</h3>
                            <p>Disse o Senhor ao meu senhor:<br>
                            "Sentai-vos √† minha direita,<br>
                            at√© que eu ponha os vossos inimigos<br>
                            por escabelo dos vossos p√©s".</p>
                            
                            <h3>C√¢ntico de Maria</h3>
                            <p>A minha alma engrandece o Senhor<br>
                            e o meu esp√≠rito se alegra em Deus, meu Salvador.</p>
                        `
                    },
                    {
                        title: 'Completas',
                        time: '21:00',
                        content: `
                            <h3>Exame de Consci√™ncia</h3>
                            <p>Irm√£os, √© chegado o fim do dia. Examinemos em sil√™ncio a nossa consci√™ncia.</p>
                            
                            <h3>Hino</h3>
                            <p>Antes que termine este dia,<br>
                            a v√≥s, Criador, suplicamos<br>
                            que nos protejais com clem√™ncia<br>
                            e nos guardeis benevolente.</p>
                            
                            <h3>Salmo 91</h3>
                            <p>Quem habita no esconderijo do Alt√≠ssimo<br>
                            e descansa √† sombra do Todo-poderoso<br>
                            diz ao Senhor: "Sois o meu ref√∫gio<br>
                            e a minha fortaleza, o meu Deus em quem confio".</p>
                            
                            <h3>C√¢ntico de Sime√£o</h3>
                            <p>Agora, Senhor, segundo a vossa palavra,<br>
                            deixai ir em paz o vosso servo.</p>
                        `
                    }
                ];

                prayersData = samplePrayers;
                
                // Salvar no cache para uso offline
                saveToCache('prayers', prayersData);
                saveToCache('lastUpdate', new Date().toISOString());
                
                renderPrayers();
                
                // Tentar buscar o feed real em background
                try {
                    const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://divineoffice.org/feed/'));
                    if (response.ok) {
                        const data = await response.json();
                        // Processar o feed XML aqui se dispon√≠vel
                        console.log('Feed data:', data.contents);
                    }
                } catch (error) {
                    console.log('Feed n√£o dispon√≠vel, usando dados de exemplo');
                }
                
            } catch (error) {
                console.error('Erro ao carregar ora√ß√µes:', error);
                
                // Tentar carregar dados do cache em caso de erro
                const cachedData = getFromCache('prayers');
                if (cachedData) {
                    prayersData = cachedData;
                    renderPrayers();
                    showError('Usando dados offline - √∫ltima atualiza√ß√£o: ' + 
                             (getFromCache('lastUpdate') || 'desconhecida'));
                } else {
                    showError('Erro ao carregar as ora√ß√µes e nenhum dado offline dispon√≠vel.');
                    prayersData = [];
                    renderPrayers();
                }
            }
        }

        // Fun√ß√£o para renderizar as ora√ß√µes
        function renderPrayers() {
            const mainContent = document.getElementById('main-content');
            
            if (prayersData.length === 0) {
                mainContent.innerHTML = '<div class="error">Nenhuma ora√ß√£o dispon√≠vel no momento.</div>';
                return;
            }
            
            const prayersHTML = prayersData.map((prayer, index) => `
                <div class="prayer-card" data-index="${index}">
                    <div class="prayer-title">
                        <span>${prayer.title}</span>
                        <span class="prayer-time">${prayer.time}</span>
                        <button class="expand-btn">‚ñº</button>
                    </div>
                    <div class="prayer-content" style="display: none;">
                        ${prayer.content}
                    </div>
                </div>
            `).join('');
            
            mainContent.innerHTML = `<div class="prayers-grid">${prayersHTML}</div>`;
            
            // Adicionar event listeners para expandir/contrair
            document.querySelectorAll('.prayer-card').forEach(card => {
                const btn = card.querySelector('.expand-btn');
                const content = card.querySelector('.prayer-content');
                
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleCard(card, content, btn);
                });
                
                card.addEventListener('click', () => {
                    toggleCard(card, content, btn);
                });
            });
        }

        // Fun√ß√£o para expandir/contrair cart√£o
        function toggleCard(card, content, btn) {
            const isExpanded = content.style.display !== 'none';
            
            if (isExpanded) {
                content.style.display = 'none';
                btn.textContent = '‚ñº';
                btn.classList.remove('expanded');
                card.classList.remove('expanded');
            } else {
                // Fechar outros cart√µes expandidos
                document.querySelectorAll('.prayer-card').forEach(otherCard => {
                    if (otherCard !== card) {
                        const otherContent = otherCard.querySelector('.prayer-content');
                        const otherBtn = otherCard.querySelector('.expand-btn');
                        otherContent.style.display = 'none';
                        otherBtn.textContent = '‚ñº';
                        otherBtn.classList.remove('expanded');
                        otherCard.classList.remove('expanded');
                    }
                });
                
                content.style.display = 'block';
                btn.textContent = '‚ñ≤';
                btn.classList.add('expanded');
                card.classList.add('expanded');
                
                // Scroll suave para o cart√£o
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Fun√ß√£o para mostrar erro
        function showError(message) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `<div class="error">${message}</div>`;
        }

        // Detectar status online/offline
        function updateOnlineStatus() {
            const indicator = document.getElementById('offline-indicator');
            if (navigator.onLine) {
                indicator.classList.remove('show');
            } else {
                indicator.classList.add('show');
            }
        }

        // Event listeners
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            updateOnlineStatus();
            fetchPrayers();
            
            // Atualizar a cada hora
            setInterval(fetchPrayers, 3600000);
        });

        // Destacar a ora√ß√£o atual baseada no hor√°rio
        function highlightCurrentPrayer() {
            const now = new Date();
            const currentHour = now.getHours();
            
            const schedule = [
                { hour: 0, title: 'Matinas' },
                { hour: 6, title: 'Laudes' },
                { hour: 9, title: 'Ter√ßa' },
                { hour: 12, title: 'Sexta' },
                { hour: 15, title: 'Nona' },
                { hour: 18, title: 'V√©speras' },
                { hour: 21, title: 'Completas' }
            ];
            
            let currentPrayer = schedule[0];
            for (const prayer of schedule) {
                if (currentHour >= prayer.hour) {
                    currentPrayer = prayer;
                }
            }
            
            // Destacar a ora√ß√£o atual
            document.querySelectorAll('.prayer-card').forEach(card => {
                const title = card.querySelector('.prayer-title span').textContent;
                if (title === currentPrayer.title) {
                    card.style.borderLeft = '4px solid var(--primary)';
                    card.style.background = 'rgba(37, 99, 235, 0.05)';
                }
            });
        }

        // Executar destaque ap√≥s renderizar
        setTimeout(highlightCurrentPrayer, 1000);
    </script>
</body>
</html>
