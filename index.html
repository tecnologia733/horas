<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Liturgia das Horas</title>
<meta name="description" content="Liturgia das Horas - Of√≠cio Divino em Portugu√™s" />
<meta name="theme-color" content="#2563eb" />
<style>
  /* CSS resumido para foco no funcional */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    color: #1e293b;
    min-height: 100vh;
    padding: 1rem;
  }
  .container {
    max-width: 800px;
    margin: auto;
  }
  header {
    background: rgba(255 255 255 / 0.95);
    padding: 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
    text-align: center;
    color: #2563eb;
  }
  header h1 {
    font-size: 2.5rem;
  }
  header p {
    font-size: 1.1rem;
    color: #64748b;
  }
  .loading {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 15px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    font-weight: 600;
  }
  .prayers-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: 1fr;
  }
  .prayer-card {
    background: rgba(255 255 255 / 0.95);
    border-radius: 20px;
    padding: 1.5rem 2rem;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
    cursor: pointer;
    user-select: none;
    transition: box-shadow 0.3s ease;
    overflow-wrap: break-word;
  }
  .prayer-card:hover {
    box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
  }
  .prayer-title {
    font-weight: 700;
    font-size: 1.5rem;
    color: #2563eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .expand-icon {
    font-weight: 700;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
  }
  .expanded .expand-icon {
    transform: rotate(180deg);
  }
  .prayer-content {
    margin-top: 1rem;
    line-height: 1.7;
    color: #1e293b;
    display: none;
    white-space: pre-wrap; /* preserva quebras e espa√ßos */
  }
  .prayer-card.expanded .prayer-content {
    display: block;
  }
  .offline-indicator {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    background: #f59e0b;
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 10px;
    font-size: 0.9rem;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
    display: none;
  }
  .offline-indicator.show {
    display: block;
  }
  @media (max-width: 640px) {
    body {
      padding: 1rem 0.5rem;
    }
    header h1 {
      font-size: 2rem;
    }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>‚õ™ Liturgia das Horas</h1>
    <p>Of√≠cio Divino em Portugu√™s Brasileiro</p>
  </header>
  <main id="main-content">
    <div class="loading">Carregando ora√ß√µes...</div>
  </main>
  <div class="offline-indicator" id="offline-indicator">üì± Modo offline ativo</div>
</div>

<script>
  const CACHE_KEY = 'liturgia-horas-prayers-v2';

  // Tradu√ß√µes chave a chave (simples, para t√≠tulo e termos)
  const translations = {
    'Invitatory': 'Invitat√≥rio',
    'Office of Readings': 'Of√≠cio de Leituras',
    'Morning Prayer': 'Ora√ß√£o da Manh√£',
    'Midmorning Prayer': 'Ora√ß√£o da Terceira',
    'Midday Prayer': 'Ora√ß√£o da Sexta',
    'Midafternoon Prayer': 'Ora√ß√£o da Nona',
    'Evening Prayer': 'Ora√ß√£o da Tarde',
    'Night Prayer': 'Ora√ß√£o da Noite',
    'Matins': 'Matinas',
    'Lauds': 'Laudes',
    'Prime': 'Prima',
    'Terce': 'Ter√ßa',
    'Sext': 'Sexta',
    'None': 'Nona',
    'Vespers': 'V√©speras',
    'Compline': 'Completas',
    'Psalm': 'Salmo',
    'Canticle': 'C√¢ntico',
    'Reading': 'Leitura',
    'Prayer': 'Ora√ß√£o',
    'Antiphon': 'Ant√≠fona',
    'Responsory': 'Respons√≥rio',
    'Hymn': 'Hino',
    'Intercessions': 'Preces',
    'Our Father': 'Pai Nosso',
    'Hail Mary': 'Ave Maria',
    'Glory Be': 'Gl√≥ria ao Pai',
    'In the name of the Father': 'Em nome do Pai',
    'and of the Son': 'e do Filho',
    'and of the Holy Spirit': 'e do Esp√≠rito Santo',
    'Amen': 'Am√©m',
    'Alleluia': 'Aleluia',
    'Lord, have mercy': 'Senhor, tende piedade',
    'Christ, have mercy': 'Cristo, tende piedade',
    'Holy, holy, holy': 'Santo, santo, santo',
    'Blessed be God': 'Bendito seja Deus',
    'Thanks be to God': 'Gra√ßas a Deus',
    'Glory to God': 'Gl√≥ria a Deus',
    'Peace be with you': 'A paz esteja convosco',
    'And with your spirit': 'E com o vosso esp√≠rito'
  };

  // Traduz texto via regex, substituindo termos chave
  function translateText(text) {
    if (!text) return text;
    let t = text;
    for (const [en, pt] of Object.entries(translations)) {
      const regex = new RegExp(en, 'gi');
      t = t.replace(regex, pt);
    }
    return t;
  }

  // Salva dados no localStorage
  function saveCache(data) {
    try {
      localStorage.setItem(CACHE_KEY, JSON.stringify(data));
    } catch {
      // ignore
    }
  }
  // Recupera cache
  function loadCache() {
    try {
      const raw = localStorage.getItem(CACHE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch {
      return null;
    }
  }

  // Pega o feed XML via proxy
  async function fetchFeed() {
    const proxy = 'https://corsproxy.io/?https://divineoffice.org/feed/';
    try {
      const res = await fetch(proxy);
      if (!res.ok) throw new Error('Rede falhou');
      return await res.text();
    } catch (e) {
      console.warn('Erro ao buscar feed:', e);
      return null;
    }
  }

  // Extrai os items do feed, filtra s√≥ do dia atual e traduz t√≠tulo + conte√∫do
  function parseFeed(xmlText) {
    const parser = new DOMParser();
    const xml = parser.parseFromString(xmlText, 'application/xml');
    const items = [...xml.querySelectorAll('item')];

    const hoje = new Date();
    // Formato para encontrar no t√≠tulo - ex: Jul 14
    const mesDia = hoje.toLocaleDateString('en-US', {month:'short', day:'2-digit'});

    // Filtra s√≥ itens que cont√©m data de hoje no t√≠tulo (ex: "Lauds, Jul 14")
    let prayers = items.filter(i => {
      const title = i.querySelector('title')?.textContent || '';
      return title.includes(mesDia);
    });

    // Extrai e traduz
    prayers = prayers.map(i => {
      const titleRaw = i.querySelector('title')?.textContent || '';
      const contentRaw = i.querySelector('description')?.textContent || '';
      return {
        title: translateText(titleRaw),
        content: translateText(stripHtml(contentRaw))
      };
    });

    return prayers;
  }

  // Remove tags HTML simples (para exibir texto limpo)
  function stripHtml(html) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || '';
  }

  // Renderiza somente os t√≠tulos na lista
  function renderTitles(prayers) {
    const main = document.getElementById('main-content');
    if (!prayers.length) {
      main.innerHTML = `<div class="loading">Nenhuma ora√ß√£o dispon√≠vel para hoje.</div>`;
      return;
    }
    main.innerHTML = '<div class="prayers-grid"></div>';
    const grid = main.querySelector('.prayers-grid');

    prayers.forEach((p, i) => {
      const card = document.createElement('div');
      card.className = 'prayer-card';
      card.innerHTML = `
        <div class="prayer-title">
          <span>${p.title}</span>
          <span class="expand-icon">‚ñº</span>
        </div>
        <div class="prayer-content"></div>
      `;

      // Expans√£o do conte√∫do traduzido ao clicar
      card.querySelector('.prayer-title').addEventListener('click', () => {
        const expanded = card.classList.toggle('expanded');
        const contentDiv = card.querySelector('.prayer-content');
        const icon = card.querySelector('.expand-icon');

        if (expanded) {
          contentDiv.textContent = p.content;
          icon.textContent = '‚ñ≤';
          card.scrollIntoView({behavior: 'smooth', block: 'start'});
        } else {
          contentDiv.textContent = '';
          icon.textContent = '‚ñº';
        }
      });

      grid.appendChild(card);
    });
  }

  async function main() {
    const main = document.getElementById('main-content');
    main.innerHTML = `<div class="loading">Carregando ora√ß√µes...</div>`;

    let prayers = null;
    let fromCache = false;

    const feedXml = await fetchFeed();
    if (feedXml) {
      prayers = parseFeed(feedXml);
      if (prayers.length) {
        saveCache(prayers);
      } else {
        prayers = loadCache();
        fromCache = true;
      }
    } else {
      prayers = loadCache();
      fromCache = true;
    }

    if (!prayers || prayers.length === 0) {
      main.innerHTML = `<div class="loading">Nenhuma ora√ß√£o encontrada.</div>`;
      return;
    }

    renderTitles(prayers);

    // Aviso modo offline se usar cache
    if (fromCache) {
      document.getElementById('offline-indicator').classList.add('show');
    }
  }

  main();

  // Opcional: detecta offline e mostra aviso
  window.addEventListener('offline', () => {
    document.getElementById('offline-indicator').classList.add('show');
  });
  window.addEventListener('online', () => {
    document.getElementById('offline-indicator').classList.remove('show');
  });
</script>
</body>
</html>
