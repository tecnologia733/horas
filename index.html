<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Liturgia das Horas - Ofício Divino</title>
<style>
  /* Reset simples */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #f0f4f8;
    margin: 0; padding: 1rem;
    color: #1e293b;
  }
  h1 {
    text-align: center;
    color: #2563eb;
    margin-bottom: 2rem;
  }
  .container {
    max-width: 900px;
    margin: 0 auto;
  }
  .prayer-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.1);
    margin-bottom: 1rem;
    cursor: pointer;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
  }
  .prayer-card:hover {
    box-shadow: 0 8px 25px rgb(0 0 0 / 0.15);
  }
  .prayer-title {
    padding: 1rem 1.5rem;
    font-weight: 700;
    font-size: 1.25rem;
    color: #2563eb;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .expand-icon {
    font-size: 1.5rem;
    transition: transform 0.3s ease;
    user-select: none;
  }
  .expanded .expand-icon {
    transform: rotate(180deg);
  }
  .prayer-content {
    padding: 1rem 1.5rem 1.5rem 1.5rem;
    display: none;
    color: #334155;
    line-height: 1.6;
  }
  .expanded .prayer-content {
    display: block;
  }
  /* Estilos para conteúdo litúrgico */
  .prayer-content h2, .prayer-content h3 {
    color: #1e40af;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }
  .prayer-content p {
    margin-bottom: 1rem;
  }
  .prayer-content em {
    font-style: italic;
    color: #475569;
  }
  .prayer-content strong {
    font-weight: 700;
  }
  .prayer-content a {
    color: #2563eb;
    text-decoration: underline;
  }
  .prayer-content ol, .prayer-content ul {
    margin-left: 1.25rem;
    margin-bottom: 1rem;
  }
  .prayer-content blockquote {
    border-left: 4px solid #2563eb;
    padding-left: 1rem;
    color: #475569;
    font-style: italic;
    margin: 1rem 0;
  }
</style>
</head>
<body>
  <h1>Liturgia das Horas - Ofício Divino</h1>
  <div class="container" id="container">
    <div id="loading">Carregando orações...</div>
  </div>

<script>
  const proxyUrl = "https://corsproxy.io/?https://divineoffice.org/feed/";

  // Tradução simples de termos
  const translations = {
    "Invitatory": "Invitatório",
    "Office of Readings": "Ofício de Leituras",
    "Morning Prayer": "Laudes",
    "Midmorning Prayer": "Terça",
    "Midday Prayer": "Sexta",
    "Midafternoon Prayer": "Nona",
    "Evening Prayer": "Vésperas",
    "Night Prayer": "Completas",
    // Frases e termos comuns
    "Psalm": "Salmo",
    "Canticle": "Cântico",
    "Reading": "Leitura",
    "Prayer": "Oração",
    "Antiphon": "Antífona",
    "Responsory": "Responsório",
    "Hymn": "Hino",
    "Intercessions": "Preces",
    "Our Father": "Pai Nosso",
    "Hail Mary": "Ave Maria",
    "Glory Be": "Glória ao Pai",
    "Amen": "Amém",
    "Alleluia": "Aleluia",
    "Lord, have mercy": "Senhor, tende piedade",
    "Christ, have mercy": "Cristo, tende piedade",
    "Holy, holy, holy": "Santo, santo, santo",
    "Blessed be God": "Bendito seja Deus",
    "Thanks be to God": "Graças a Deus",
    "Glory to God": "Glória a Deus",
    "Peace be with you": "A paz esteja convosco",
    "And with your spirit": "E com o vosso espírito"
  };

  // Função que traduz texto dentro de nós de texto, preservando HTML
  function translateHTML(htmlString) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlString, 'text/html');
    const walker = document.createTreeWalker(doc.body, NodeFilter.SHOW_TEXT);
    while(walker.nextNode()) {
      const node = walker.currentNode;
      let txt = node.textContent;
      for (const [en, pt] of Object.entries(translations)) {
        // substitui termos respeitando maiúsculas/minúsculas
        const regex = new RegExp('\\b' + en + '\\b', 'gi');
        txt = txt.replace(regex, match => {
          // Mantém maiúsculas no início, minusculas no resto
          if (match[0] === match[0].toUpperCase()) {
            return pt.charAt(0).toUpperCase() + pt.slice(1);
          } else {
            return pt.toLowerCase();
          }
        });
      }
      node.textContent = txt;
    }
    return doc.body.innerHTML;
  }

  // Função para buscar e processar o feed RSS
  async function fetchAndRender() {
    const container = document.getElementById('container');
    const loading = document.getElementById('loading');
    try {
      const response = await fetch(proxyUrl);
      if (!response.ok) throw new Error('Erro ao buscar feed');

      const data = await response.text();
      // A resposta é JSON com o campo contents que tem o XML
      const json = JSON.parse(data);
      const xmlText = json.contents;

      // Parse XML
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, "application/xml");

      const items = xmlDoc.querySelectorAll('item');

      // Data de hoje pra filtrar só orações atuais
      const today = new Date();
      const todayMonthDay = today.toLocaleDateString('en-US', {month:'short', day:'2-digit'});

      // Array pra armazenar orações do dia
      const prayers = [];

      items.forEach(item => {
        const title = item.querySelector('title')?.textContent || "";
        const pubDate = item.querySelector('pubDate')?.textContent || "";
        // Filtra só títulos que tenham a data de hoje (ex: "Morning Prayer - Jul 14")
        if(title.includes(todayMonthDay)) {
          // Conteúdo com html (description)
          const content = item.querySelector('description')?.textContent || "";
          prayers.push({title, content});
        }
      });

      if(prayers.length === 0) {
        loading.textContent = "Nenhuma oração disponível para hoje.";
        return;
      }

      loading.style.display = 'none';

      // Cria cards só com título (hora canônica traduzida), conteúdo escondido
      prayers.forEach(({title, content}, i) => {
        // Traduz título (apenas, para o card)
        let translatedTitle = title;
        for(const [en, pt] of Object.entries(translations)) {
          const regex = new RegExp('\\b' + en + '\\b', 'gi');
          translatedTitle = translatedTitle.replace(regex, pt);
        }
        const card = document.createElement('div');
        card.className = 'prayer-card';
        card.setAttribute('tabindex', '0');

        const titleDiv = document.createElement('div');
        titleDiv.className = 'prayer-title';
        titleDiv.innerHTML = `${translatedTitle} <span class="expand-icon">▼</span>`;

        const contentDiv = document.createElement('div');
        contentDiv.className = 'prayer-content';

        // Traduz o conteúdo com HTML preservado
        contentDiv.innerHTML = translateHTML(content);

        card.appendChild(titleDiv);
        card.appendChild(contentDiv);

        // Toggle expand
        titleDiv.addEventListener('click', () => {
          card.classList.toggle('expanded');
        });
        card.addEventListener('keydown', (e) => {
          if(e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            card.classList.toggle('expanded');
          }
        });

        container.appendChild(card);
      });

    } catch (e) {
      loading.textContent = "Erro ao carregar orações: " + e.message;
      console.error(e);
    }
  }

  fetchAndRender();
</script>
</body>
</html>
